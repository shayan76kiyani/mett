<!DOCTYPE html>
<html dir="rtl" lang="fa-IR">

<head>
    <% include ../partials/head %>
    <style>
        .hide{
            display: none !important;
        }
        .inline{
            display: inline-block;
        }
    </style>
</head>

<body class="header-light sidebar-dark sidebar-expand">
<div id="wrapper" class="wrapper">
    <!-- .navbar -->
    <% include ../partials/navbar %>
    <!-- /.navbar -->
    <div class="content-wrapper">
        <!-- SIDEBAR -->
        <% include ../partials/aside %>
        <!-- SIDEBAR -->
        <main class="main-wrapper clearfix">
            <!-- Page Title Area -->
            <div class="row page-title clearfix">
                <div class="page-title-left">
                    <h5 class="mr-0 ml-r-5"><%= title %></h5>
                </div>
                <!-- /.page-title-left -->
            </div>
            <!-- /.page-title -->
            <!-- =================================== -->
            <!-- Different data widgets ============ -->
            <!-- =================================== -->
            <div class="widget-list">
                <div class="row">
                    <div class="col-md-12 widget-holder" id="inst">
                        <div class="widget-bg">
                            <div class="widget-body clearfix">
                                <h5>دستورالعمل :</h5>
                                <br>
                                <p>زمانی که بر روی دکمه شروع کلیک کنید، تصاویری را به صورت متوالی خواهید دید که در ابتدا حالت خنثی و طبیعی دارند. چهره به صورت اتوماتیک ریزحالت مربوطه را بروز داده و سپس به حالت خنثی و طبیعی بازمی‌گردد. </p>
                                <p>پس از بروز هر ریزحالت، هیجانی را که فکر می‌کنید ابراز شده است با کلیک کردن بر روی هریک از هیجاناتی که به صورت گزینه برای شما ارائه گردیده است مشخص کنید.</p>
                                <p>پس از اولین انتخاب در صورت صحیح بودن پاسخ 3 گزینه برای شما ظاهر شده و در صورت نادرست بودن 1 گزینۀ به اسم تکرار ظاهر خواهد شد. می‌توانید روی دکمه تکرار کلیک کرده تا هرچندبار که دوست دارید هیجان بروز پیدا کند. پس از پیدا کردن پاسخ درست می‌توانید با کلیک کردن بر روی دکمه ثبات ریزحالت بروز داده شده را به صورت ثابت و با جزئیات کامل مشاهده کنید. زمانی که تمرین هر چهره را به پایان رساندید، بر روی دکمه بعدی کلیک کرده تا به مرحله بعد پیش بروید.</p>
                                <p>در نهایت پس از اتمام تمامی مراحل تمرین، بر روی دکمۀ مرحلۀ بعدی کلیک کنید تا به مرحلۀ پس آزمون بروید.</p>
                                <br>
                                <button class="btn btn-outline-info mr-r-10 mr-b-10" id="start">شروع تمرین</button>
                            </div>
                            <!-- /.widget-body -->
                        </div>
                        <!-- /.widget-bg -->
                    </div>
                    <div class="col-md-12 widget-holder">
                        <div class="widget-bg-transparent">
                            <div class="widget-body clearfix">
                                <!-- Products List -->
                                <ul class="ecommerce-products ecommerce-horizontal-products list-unstyled">
                                    <% a=0; if(Practices.length > 0){%>
                                        <% Practices.forEach(function(practice) {a++; %>
                                            <li class="media hide" id="exam<%= a%>">
                                                <div class="d-flex mr-0 product-image" id="pic<%= practice._id %>" style="height: 400px;">
                                                    <img class="my-0" id="firstPic<%= practice._id %>" src="<%= practice.firstPic %>" style="max-width: 296px;">
                                                    <img class="my-0 hide" id="secondPic<%= practice._id %>" src="<%=practice.secondPic %>" style="max-width: 296px;">
                                                </div>
                                                <div class="media-body">
                                                    <section>
                                                        <p id="p<%= practice._id%>">تصویر <%= a%>
                                                            <button class="btn btn-warning mr-r-10 mr-b-10 float-left" id="ShowPic<%= practice._id%>">شروع</button>
                                                            <div style="float:left;">
                                                                <button class="btn btn-outline-default mr-r-10 mr-b-10 hide" id="repeat<%= practice._id%>">تکرار</button>
                                                                <button class="btn btn-outline-default mr-r-10 mr-b-10 hide" id="freeze<%= practice._id%>">ثبات</button>
                                                                <button class="btn btn-outline-default mr-r-10 mr-b-10 hide" id="next<%= practice._id%>">بعدی</button>
                                                            </div>
                                                        </p>
                                                        <hr style="margin-top: 35px;">
                                                        <div class="button-box mr-t-20">
                                                            <% practice.options.forEach(function(option) { %>
                                                                <% if(option.option != ""){%>
                                                                    <button class="btn btn-outline-info mr-r-10 mr-b-10" id="<%= option._id %>"><%= option.option %></button>
                                                                <%}%>
                                                            <% }); %>
                                                        </div>
                                                    </section>
                                                </div>
                                            </li>
                                        <% }); %>
                                    <% } %>
                                </ul>
                                <!-- /.ecommerce-products -->
                                <!-- Product Navigation -->
                            </div>
                            <!-- /.widget-body -->
                        </div>
                        <!-- /.widget-bg -->
                    </div>
                    <!-- /.widget-holder -->
                    <% if(Practices.length == a || Practices.length == 0){ a++;%>
                        <div class="col <% if(a != 1 ){ %> hide <% } %>" id="exam<%= a%>">
                            <div class="row">
                                <div class="col-md-6 widget-holder">
                                    <div class="widget-bg">
                                        <div class="widget-body clearfix">
                                            <h5 class="box-title">Pie Chart</h5>
                                            <canvas id="chartJsPie" height="150"></canvas>
                                        </div>
                                        <!-- /.widget-body -->
                                    </div>
                                    <!-- /.widget-bg -->
                                </div>
                                    <!-- /.widget-holder -->
                                <div class="col-md-6 widget-holder">
                                    <div class="widget-bg">
                                        <div class="widget-body clearfix">
                                            <% if(locals.allTests){ %>
                                                <p style="text-align:center">تعداد سوالات : <%=allTests %></p>
                                                <% if(mark >= 0){ %>
                                                    <p style="text-align:center" id="oldMark">تعداد پاسخ های درست : <%=mark %></p>
                                                    <p style="text-align:center" id="oldPrecent">درصد پاسخ گویی : <%-((100/allTests) * mark).toFixed(2) %></p>
                                                <% } %>
                                                <p style="text-align:center" id="mark"></p>
                                                <p style="text-align:center" id="precent"></p>
                                            <% } %>
                                            <div class="button-box mr-t-20">
                                                <form action="/dashboard/practice" method="POST">
                                                    <input  class="btn btn-outline-info mr-r-10 mr-b-10" style="margin: 0 auto !important; display: block;" type="submit" name="done" value="مرحله بعد">
                                                </form>
                                            </div>
                                        </div>
                                        <!-- /.widget-body -->
                                    </div>
                                    <!-- /.widget-bg -->
                                </div>
                                <!-- /.widget-holder -->
                            </div>
                        </div>
                    <% } %>
                </div>
                <!-- /.row -->
            </div>
            <!-- /.widget-list -->
        </main>
        <!-- /.main-wrappper -->
        <!-- RIGHT SIDEBAR -->
        <aside class="right-sidebar scrollbar-enabled">
            <div class="sidebar-chat" data-plugin="chat-sidebar">
                <div class="sidebar-chat-info">
                    <h3>Chat</h3>
                    <p class="text-muted">You can chat with your family and friends in this space.</p>
                </div>
                <div class="chat-list">
                    <h6 class="sidebar-chat-subtitle">Online</h6>
                    <div class="list-group row">
                        <a href="javascript:void(0)" class="list-group-item user--online thumb-xs"
                           data-chat-user="Julein Renvoye">
                            <img src="/assets/demo/users/user1.jpg" class="rounded-circle" alt=""> <span class="name">Julien Renvoye</span>
                            <span class="username">@jrenvoye</span>
                        </a>
                        <a href="javascript:void(0)" class="list-group-item user--online thumb-xs"
                           data-chat-user="Eddie Lebanovkiy">
                            <img src="/assets/demo/users/user2.jpg" class="rounded-circle" alt=""> <span class="name">Eddie Lebanovskiy</span>
                            <span class="username">@elebano</span>
                        </a>
                        <a href="javascript:void(0)" class="list-group-item user--away thumb-xs"
                           data-chat-user="Cameron Moll">
                            <img src="/assets/demo/users/user3.jpg" class="rounded-circle" alt=""> <span class="name">Cameron Moll</span>
                            <span class="username">@cammoll</span>
                        </a>
                        <a href="javascript:void(0)" class="list-group-item user--busy thumb-xs"
                           data-chat-user="Bill S Kenny">
                            <img src="/assets/demo/users/user7.jpg" class="rounded-circle" alt=""> <span class="name">Bill S Kenny</span>
                            <span class="username">@billsk</span>
                        </a>
                        <a href="javascript:void(0)" class="list-group-item user--busy thumb-xs"
                           data-chat-user="Trent Walton">
                            <img src="/assets/demo/users/user6.jpg" class="rounded-circle" alt=""> <span class="name">Trent Walton</span>
                            <span class="username">@trentwalton</span>
                        </a>
                    </div>
                    <!-- /.list-group -->
                </div>
                <!-- /.chat-list -->
                <div class="chat-list">
                    <h6 class="sidebar-chat-subtitle">Offline</h6>
                    <div class="list-group row">
                        <a href="javascript:void(0)" class="list-group-item user--offline thumb-xs"
                           data-chat-user="Julien Renvoye">
                            <img src="/assets/demo/users/user1.jpg" class="rounded-circle" alt=""> <span class="name">Julien Renvoye</span>
                            <span class="username">@jrenvoye</span>
                        </a>
                        <a href="javascript:void(0)" class="list-group-item user--offline thumb-xs"
                           data-chat-user="Eddie Lebaovskiy">
                            <img src="/assets/demo/users/user2.jpg" class="rounded-circle" alt=""> <span class="name">Eddie Lebanovskiy</span>
                            <span class="username">@elebano</span>
                        </a>
                        <a href="javascript:void(0)" class="list-group-item user--offline thumb-xs"
                           data-chat-user="Cameron Moll">
                            <img src="/assets/demo/users/user3.jpg" class="rounded-circle" alt=""> <span class="name">Cameron Moll</span>
                            <span class="username">@cammoll</span>
                        </a>
                        <a href="javascript:void(0)" class="list-group-item user--offline thumb-xs"
                           data-chat-user="Bill S Kenny">
                            <img src="/assets/demo/users/user7.jpg" class="rounded-circle" alt=""> <span class="name">Bill S Kenny</span>
                            <span class="username">@billsk</span>
                        </a>
                        <a href="javascript:void(0)" class="list-group-item user--offline thumb-xs"
                           data-chat-user="Trent Walton">
                            <img src="/assets/demo/users/user6.jpg" class="rounded-circle" alt=""> <span class="name">Trent Walton</span>
                            <span class="username">@trentwalton</span>
                        </a>
                    </div>
                    <!-- /.list-group -->
                </div>
                <!-- /.chat-list -->
            </div>
            <!-- /.sidebar-chat -->
        </aside>
        <!-- CHAT PANEL -->
        <div class="chat-panel" hidden>
            <div class="card">
                <div class="card-header">
                    <button type="button" class="close" aria-label="Close"><span aria-hidden="true">&times;</span>
                    </button>
                    <button type="button" class="minimize" aria-label="Minimize"><span aria-hidden="true"><i
                            class="material-icons">expand_more</i></span>
                    </button>
                    <span class="user-name">John Doe</span>
                </div>
                <!-- /.card-header -->
                <div class="card-block custom-scroll">
                    <div class="messages custom-scroll-content scrollbar-enabled">
                        <div class="current-user-message">
                            <img class="user-image" width="30" height="30" src="/assets/demo/users/user1.jpg" alt="">
                            <div class="message">
                                <p>Lorem ipsum dolor sit amet?</p>
                                <small>10:00 am</small>
                            </div>
                            <!-- /.message -->
                        </div>
                        <!-- /.current-user-message -->
                        <div class="other-user-message">
                            <img class="user-image" width="30" height="30" src="/assets/demo/users/user2.jpg" alt="">
                            <div class="message">
                                <p>Etiam rhoncus. Maecenas tempus, tellus eget condi mentum rhoncus</p>
                                <small>10:00 am</small>
                            </div>
                            <!-- /.message -->
                        </div>
                        <!-- /.other-user-message -->
                        <div class="current-user-message">
                            <img class="user-image" width="30" height="30" src="/assets/demo/users/user1.jpg" alt="">
                            <div class="message">
                                <img src="/assets/demo/chat-message.jpg" alt="">
                                <small>10:00 am</small>
                            </div>
                            <!-- .,message -->
                        </div>
                        <!-- /.current-user-message -->
                        <div class="current-user-message">
                            <img class="user-image" width="30" height="30" src="/assets/demo/users/user1.jpg" alt="">
                            <div class="message">
                                <p>Maecenas nec odio et ante tincidunt tempus.</p>
                                <small>10:00 am</small>
                            </div>
                            <!-- .,message -->
                        </div>
                        <!-- /.current-user-message -->
                        <div class="other-user-message">
                            <img class="user-image" width="30" height="30" src="/assets/demo/users/user2.jpg" alt="">
                            <div class="message">
                                <p>Donec sodales :)</p>
                                <small>10:00 am</small>
                            </div>
                            <!-- /.message -->
                        </div>
                        <!-- /.other-user-message -->
                    </div>
                    <!-- /.messages -->
                    <form action="javascript:void(0)" method="post">
                        <textarea name="message" style="resize: none"
                                  placeholder="Type message and hit enter"></textarea>
                        <ul class="list-unstyled list-inline chat-extra-buttons">
                            <li class="list-inline-item"><a href="javascript:void(0)"><i class="material-icons">insert_emoticon</i></a>
                            </li>
                            <li class="list-inline-item"><a href="javascript:void(0)"><i class="material-icons">attach_file</i></a>
                            </li>
                        </ul>
                        <button class="btn btn-color-scheme btn-circle submit-btn" type="submit"><i
                                class="material-icons">send</i>
                        </button>
                    </form>
                </div>
                <!-- /.panel-body -->
            </div>
            <!-- /.panel -->
        </div>
        <!-- /.chat-panel -->
    </div>
    <!-- /.content-wrapper -->
    <!-- FOOTER -->
    <% include ../partials/footer %>
</div>
<!--/ #wrapper -->
<!-- Scripts -->
<% include ../partials/scripts %>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.4.0/Chart.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.6.0/Chart.bundle.min.js"></script>
<script>
    $(document).ready(function(){
        var ctx = document.getElementById("chartJsPie");
      if ( ctx === null ) return;

      var a = <%=mark %>;
      var b = <%=allTests %> - <%=mark %>;
      var ctx3 = document.getElementById("chartJsPie").getContext("2d");

      $("#start").click(function(){
            $("#inst").remove();
            $("#exam1").removeClass("hide");
        });

      if ($('#exam<%= Practices.length + 1 %>').hasClass("hide")) {
        }else {
            var data3 = {
                labels: [
                "درست",
                "غلط"
                ],
                datasets: [
                {
                    data: [1*a , 1*b],
                    backgroundColor: [
                    "#545d73",
                    "#dd4444"
                    ],
                    hoverBackgroundColor: [
                    "#4a5368",
                    "#bd3b47"
                    ]
                }]
            };
            var chartJsPie = new Chart(ctx3,{
                type: "pie",
                data: data3,
                responsive: true,
                options: {
                    legend: {
                    display: false
                    },
                    tooltips: {
                    mode: 'index',
                    intersect: false,
                    titleFontColor: "#000",
                    titleMarginBottom: 0,
                    backgroundColor: "rgba(255,255,255,.9)",
                    bodyFontColor: "#000",
                    borderColor: "#e9e9e9",
                    bodySpacing: 0,
                    borderWidth: 0,
                    xPadding: 10,
                    yPadding: 10,
                    },
                }
            });
        }
            
        <% if(Practices.length > 0){ b=0; %>
            <% Practices.forEach(function(practice) { b++; %>
                $("#ShowPic<%= practice._id %>").click(function(){
                    $("#ShowPic<%= practice._id %>").remove();
                    setTimeout(function() {
                        $("#firstPic<%= practice._id %>").toggleClass("hide");
                        $("#secondPic<%= practice._id %>").toggleClass("hide");
                        setTimeout(function() {
                            $("#firstPic<%= practice._id %>").toggleClass("hide");
                            $("#secondPic<%= practice._id %>").toggleClass("hide");
                        }, <% if( locals.speed ){ %><%=speed %><% }%>);
                    }, 1000);
                });
                $("#repeat<%= practice._id %>").click(function(){
                    setTimeout(function() {
                        $("#firstPic<%= practice._id %>").toggleClass("hide");
                        $("#secondPic<%= practice._id %>").toggleClass("hide");
                        setTimeout(function() {
                            $("#firstPic<%= practice._id %>").toggleClass("hide");
                            $("#secondPic<%= practice._id %>").toggleClass("hide");
                        }, <% if( locals.speed ){ %><%=speed %><% }%>);
                    }, 1000);
                });
                $("#freeze<%= practice._id %>").click(function(){
                    $("#firstPic<%= practice._id %>").toggleClass("hide");
                    $("#secondPic<%= practice._id %>").toggleClass("hide");
                });
                $("#next<%= practice._id %>").click(function(){
                    $("#exam<%= b%>").remove();
                    $("#exam<%= b + 1%>").removeClass('hide');
                    $(document).trigger('exam<%= b + 1%>');
                });
                <% practice.options.forEach(function(option) { %>
                    $("#<%= option._id %>").click(function(){
                        $.post("/dashboard/practice" ,{ option : "<%= option._id %>" } , function (data) {
                            if (data['status'] == 200) {
                                $('#<%= option._id %>').removeClass('btn-outline-info');
                                $('#<%= option._id %>').addClass('btn-success');
                                $('#repeat<%= practice._id%>').removeClass('hide');
                                $('#next<%= practice._id%>').removeClass('hide');
                                $('#freeze<%= practice._id%>').removeClass('hide');
                                $('#p<%= practice._id%>').addClass('inline');
                                $("#ShowPic<%= practice._id %>").remove();
                                $("#mark").html('تعداد پاسخ های درست : ' + data['mark']);
                                $("#precent").html('درصد پاسخ گویی : ' + ((100/<%- allTests %>)*data['mark']).toFixed(2));
                                $("#oldMark").remove();
                                $("#oldPrecent").remove();
                                a = data['mark'];
                                b = <%=allTests%> - data['mark'];
                            }
                            else if (data['status'] == 300) {
                                $('#<%= option._id %>').removeClass('btn-outline-info');
                                $('#<%= option._id %>').addClass('btn-danger');
                                $('#repeat<%= practice._id%>').removeClass('hide');
                                $('#p<%= practice._id%>').addClass('inline');
                                $("#ShowPic<%= practice._id %>").remove();
                                $("#mark").html('تعداد پاسخ های درست : ' + data['mark']);
                                $("#precent").html('درصد پاسخ گویی : ' + ((100/<%- allTests %>)*data['mark']).toFixed(2));
                                $("#oldMark").remove();
                                $("#oldPrecent").remove();
                                a = data['mark'];
                                b = <%=allTests%> - data['mark'];
                            }
                            else if (data['status'] == 400) {
                                alert('شما قبلا پاسخ درست را داده اید');
                            }
                            else if (data['status'] == 500) {
                                data['practice'].options.forEach(function(element){
                                    if (element.option == data['practice'].trueOption){
                                        $('#'+element._id ).removeClass('btn-outline-info');
                                        $('#'+element._id ).addClass('btn-success');
                                    }
                                });
                                $('#<%= option._id %>').removeClass('btn-outline-info');
                                $('#<%= option._id %>').addClass('btn-danger');
                                $('#repeat<%= practice._id%>').removeClass('hide');
                                $('#next<%= practice._id%>').removeClass('hide');
                                $('#freeze<%= practice._id%>').removeClass('hide');
                                $('#p<%= practice._id%>').addClass('inline');
                                $("#ShowPic<%= practice._id %>").remove();
                                $("#mark").html('تعداد پاسخ های درست : ' + data['mark']);
                                $("#precent").html('درصد پاسخ گویی : ' + ((100/<%- allTests %>)*data['mark']).toFixed(2));
                                $("#oldMark").remove();
                                $("#oldPrecent").remove();
                                a = data['mark'];
                                b = <%=allTests%> - data['mark'];
                            }
                            else {
                                alert('شما دوبار جواب اشتباه را انتخاب کرده اید و امکان پاسخ دادن دوباره را ندارید');
                            }
                        });
                    });
                <% }); %>
            <% }); %>
        <% } %>
        $(document).on('exam<%= Practices.length + 1 %>', function() {
            var data3 = {
                labels: [
                "درست",
                "غلط"
                ],
                datasets: [
                {
                    data: [1*a , 1*b],
                    backgroundColor: [
                    "#545d73",
                    "#dd4444"
                    ],
                    hoverBackgroundColor: [
                    "#4a5368",
                    "#bd3b47"
                    ]
                }]
            };
            var chartJsPie = new Chart(ctx3,{
                type: "pie",
                data: data3,
                responsive: true,
                options: {
                    legend: {
                    display: false
                    },
                    tooltips: {
                    mode: 'index',
                    intersect: false,
                    titleFontColor: "#000",
                    titleMarginBottom: 0,
                    backgroundColor: "rgba(255,255,255,.9)",
                    bodyFontColor: "#000",
                    borderColor: "#e9e9e9",
                    bodySpacing: 0,
                    borderWidth: 0,
                    xPadding: 10,
                    yPadding: 10,
                    },
                }
            });
        });
    });
</script>
</body>

</html>
